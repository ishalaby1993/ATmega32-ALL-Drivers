/*
 * TIMER2.c
 *
 *  Created on: Mar 18, 2019
 *      Author: Muhammad Elzeiny
 */

#define TIMER2_MODE_NORMAL_MSK			0b00000000
#define TIMER2_MODE_CTC_MSK   			0b00001000
#define TIMER2_MODE_FAST_PWM_MSK		0b01001000
#define TIMER2MODE_PHASE_CORRECT_MSK	0b01000000

#define TIMER2_PRESCALER_NO_MSK  		0b00000001
#define TIMER2_PRESCALER_8_MSK   		0b00000010
#define TIMER2_PRESCALER_64_MSK  		0b00000011
#define TIMER2_PRESCALER_256_MSK 		0b00000100
#define TIMER2_PRESCALER_1024_MSK		0b00000101

#define TIMER2_OUTPUT_NONE_MSK  		0b00000000
#define TIMER2_OUTPUT_TOGGLE_MSK		0b00010000
#define TIMER2_OUTPUT_SET_MSK   		0b00110000
#define TIMER2_OUTPUT_CLEAR_MSK 		0b00100000

#define FAST_PWM_NONE_INVERTING_MODE_MSK	0b00100000
#define FAST_PWM_INVERTING_MODE_MSK			0b00110000

#define PHASE_CORRECT_CLEAR_UP_COUNTING		0b00100000
#define PHASE_CORRECT_SET_UP_COUNTING		0b00110000

#include "../../LIB/STD_TYPES.h"
#include "../../LIB/BIT_MATH.h"

#include "TIMER2_reg.h"
#include "TIMER2_cfg.h"
#include "TIMER2.h"

void TIMER2_init(void)
{
	/*clear control registers*/
	TCCR2 = 0;

	/* select mode*/
	TCCR2 |= TIMER2_MODE_SELECTOR_MSK;

	/*set output status on OC2*/
#if TIMER2_MODE_SELECTOR_MSK == TIMER2_MODE_FAST_PWM_MSK
	TCCR2 |= TIMER2_FAST_PWM_OC2_PIN_OUTPUT_MSK;
#elif TIMER2_MODE_SELECTOR_MSK == TIMER2_MODE_PHASE_CORRECT
	TCCR2 |= TIMER2_PHASE_CORRECT_OC2_PIN_OUTPUT_MSK;
#else
	TCCR2 |= TIMER2_NON_PWM_OC2_PIN_OUTPUT_MSK;
#endif

	/*set steps to count*/
	OCR2 = TIMER2_STEPS_COMPARED_VALUE;
	/*select Prescaler*/
	TCCR2 |= TIMER2_PRESCALER_SELECTOR_MSK;

}
void TIMER2_enInterrupt(void)
{
#if TIMER2_MODE_SELECTOR_MSK == TIMER2_MODE_CTC_MSK
	SET_BIT(TIMSK,7);
#elif TIMER2_MODE_SELECTOR_MSK == TIMER2_MODE_NORMAL_MSK
	SET_BIT(TIMSK,6);
#endif

}
void TIMER2_diInterrupt(void)
{
#if TIMER2_MODE_SELECTOR_MSK == TIMER2_MODE_CTC_MSK
	CLR_BIT(TIMSK,7);
#elif TIMER2_MODE_SELECTOR_MSK == TIMER2_MODE_NORMAL_MSK
	CLR_BIT(TIMSK,6);
#endif
}
void TIMER2_setCounterSteps(u8 StepsNo)
{
	TCNT2 = StepsNo;
}

u8 TIMER2_getCurrentCounterSteps(void)
{
	return TCNT2;
}
void TIMER2_setComparedValue(u8 ComparedValue)
{
	OCR2=ComparedValue;
}
